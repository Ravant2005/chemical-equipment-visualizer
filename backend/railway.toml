# Railway configuration for Django backend
# Using NIXPACKS builder for Python

[build]
builder = "NIXPACKS"

[deploy]
# PRE-DEPLOY: migrations + collectstatic (runs before each deploy)
preDeployCommand = "python manage.py migrate --noinput && python manage.py collectstatic --noinput"

# START: Gunicorn with optimized settings for Railway
# - bind 0.0.0.0:$PORT (required by Railway)
# - workers 2 (good balance for small-medium apps)
# - timeout 120 (allows migrations to complete during startup)
startCommand = "gunicorn backend.wsgi:application --bind 0.0.0.0:$PORT --workers 2 --timeout 120"

# Health check configuration
healthcheckPath = "/api/health/"
healthcheckTimeout = 300

# Restart policy
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10

